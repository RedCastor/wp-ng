!function(t,r){"function"==typeof define&&define.amd?define(r):"object"==typeof exports?module.exports=r():t.Sifter=r()}(this,function(){var t=function(t,r){this.items=t,this.settings=r||{diacritics:!0}};t.prototype.tokenize=function(t){if(!(t=u(String(t||"").toLowerCase()))||!t.length)return[];var r,e,n,i,o=[],s=t.split(/ +/);for(r=0,e=s.length;r<e;r++){if(n=f(s[r]),this.settings.diacritics)for(i in p)p.hasOwnProperty(i)&&(n=n.replace(new RegExp(i,"g"),p[i]));o.push({string:s[r],regex:new RegExp(n,"i")})}return o},t.prototype.iterator=function(t,r){(s(t)?Array.prototype.forEach||function(t){for(var r=0,e=this.length;r<e;r++)t(this[r],r,this)}:function(t){for(var r in this)this.hasOwnProperty(r)&&t(this[r],r,this)}).apply(t,[r])},t.prototype.getScoreFunction=function(t,r){var i,o,s,u;t=this.prepareSearch(t,r),o=t.tokens,i=t.options.fields,s=o.length,u=t.options.nesting;var f,p=function(t,r){var e,n;return t?-1===(n=(t=String(t||"")).search(r.regex))?0:(e=r.string.length/t.length,0===n&&(e+=.5),e):0},c=(f=i.length)?1===f?function(t,r){return p(g(r,i[0],u),t)}:function(t,r){for(var e=0,n=0;e<f;e++)n+=p(g(r,i[e],u),t);return n/f}:function(){return 0};return s?1===s?function(t){return c(o[0],t)}:"and"===t.options.conjunction?function(t){for(var r,e=0,n=0;e<s;e++){if((r=c(o[e],t))<=0)return 0;n+=r}return n/s}:function(t){for(var r=0,e=0;r<s;r++)e+=c(o[r],t);return e/s}:function(){return 0}},t.prototype.getSortFunction=function(t,e){var r,n,i,o,s,u,f,p,c,a,l;if(l=!(t=(i=this).prepareSearch(t,e)).query&&e.sort_empty||e.sort,c=function(t,r){return"$score"===t?r.score:g(i.items[r.id],t,e.nesting)},s=[],l)for(r=0,n=l.length;r<n;r++)(t.query||"$score"!==l[r].field)&&s.push(l[r]);if(t.query){for(a=!0,r=0,n=s.length;r<n;r++)if("$score"===s[r].field){a=!1;break}a&&s.unshift({field:"$score",direction:"desc"})}else for(r=0,n=s.length;r<n;r++)if("$score"===s[r].field){s.splice(r,1);break}for(p=[],r=0,n=s.length;r<n;r++)p.push("desc"===s[r].direction?-1:1);return(u=s.length)?1===u?(o=s[0].field,f=p[0],function(t,r){return f*h(c(o,t),c(o,r))}):function(t,r){var e,n,i;for(e=0;e<u;e++)if(i=s[e].field,n=p[e]*h(c(i,t),c(i,r)))return n;return 0}:null},t.prototype.prepareSearch=function(t,r){if("object"==typeof t)return t;var e=(r=o({},r)).fields,n=r.sort,i=r.sort_empty;return e&&!s(e)&&(r.fields=[e]),n&&!s(n)&&(r.sort=[n]),i&&!s(i)&&(r.sort_empty=[i]),{options:r,query:String(t||"").toLowerCase(),tokens:this.tokenize(t),total:0,items:[]}},t.prototype.search=function(t,e){var n,i,r,o,s=this;return i=this.prepareSearch(t,e),e=i.options,t=i.query,o=e.score||s.getScoreFunction(i),t.length?s.iterator(s.items,function(t,r){n=o(t),(!1===e.filter||0<n)&&i.items.push({score:n,id:r})}):s.iterator(s.items,function(t,r){i.items.push({score:1,id:r})}),(r=s.getSortFunction(i,e))&&i.items.sort(r),i.total=i.items.length,"number"==typeof e.limit&&(i.items=i.items.slice(0,e.limit)),i};var h=function(t,r){return"number"==typeof t&&"number"==typeof r?r<t?1:t<r?-1:0:(t=e(String(t||"")),(r=e(String(r||"")))<t?1:t<r?-1:0)},o=function(t,r){var e,n,i,o;for(e=1,n=arguments.length;e<n;e++)if(o=arguments[e])for(i in o)o.hasOwnProperty(i)&&(t[i]=o[i]);return t},g=function(t,r,e){if(t&&r){if(!e)return t[r];for(var n=r.split(".");n.length&&(t=t[n.shift()]););return t}},u=function(t){return(t+"").replace(/^\s+|\s+$|/g,"")},f=function(t){return(t+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")},s=Array.isArray||"undefined"!=typeof $&&$.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},p={a:"[aá¸€á¸Ä‚ÄƒÃ‚Ã¢ÇÇŽÈºâ±¥È¦È§áº áº¡Ã„Ã¤Ã€Ã ÃÃ¡Ä€ÄÃƒÃ£Ã…Ã¥Ä…Ä„ÃƒÄ…Ä„]",b:"[bâ¢Î²Î’Bà¸¿ðŒá›’]",c:"[cÄ†Ä‡ÄˆÄ‰ÄŒÄÄŠÄ‹CÌ„cÌ„Ã‡Ã§á¸ˆá¸‰È»È¼Æ‡ÆˆÉ•á´„ï¼£ï½ƒ]",d:"[dÄŽÄá¸Šá¸‹á¸á¸‘á¸Œá¸á¸’á¸“á¸Žá¸ÄÄ‘DÌ¦dÌ¦Æ‰É–ÆŠÉ—Æ‹ÆŒáµ­á¶á¶‘È¡á´…ï¼¤ï½„Ã°]",e:"[eÃ‰Ã©ÃˆÃ¨ÃŠÃªá¸˜á¸™ÄšÄ›Ä”Ä•áº¼áº½á¸šá¸›áººáº»Ä–Ä—Ã‹Ã«Ä’Ä“È¨È©Ä˜Ä™á¶’É†É‡È„È…áº¾áº¿á»€á»á»„á»…á»‚á»ƒá¸œá¸á¸–á¸—á¸”á¸•È†È‡áº¸áº¹á»†á»‡â±¸á´‡ï¼¥ï½…É˜ÇÆÆÎµ]",f:"[fÆ‘Æ’á¸žá¸Ÿ]",g:"[gÉ¢â‚²Ç¤Ç¥ÄœÄÄžÄŸÄ¢Ä£Æ“É Ä Ä¡]",h:"[hÄ¤Ä¥Ä¦Ä§á¸¨á¸©áº–áº–á¸¤á¸¥á¸¢á¸£É¦Ê°Ç¶Æ•]",i:"[iÃÃ­ÃŒÃ¬Ä¬Ä­ÃŽÃ®ÇÇÃÃ¯á¸®á¸¯Ä¨Ä©Ä®Ä¯ÄªÄ«á»ˆá»‰ÈˆÈ‰ÈŠÈ‹á»Šá»‹á¸¬á¸­Æ—É¨É¨Ì†áµ»á¶–Ä°iIÄ±Éªï¼©ï½‰]",j:"[jÈ·Ä´ÄµÉˆÉ‰ÊÉŸÊ²]",k:"[kÆ˜Æ™ê€êá¸°á¸±Ç¨Ç©á¸²á¸³á¸´á¸µÎºÏ°â‚­]",l:"[lÅÅ‚Ä½Ä¾Ä»Ä¼Ä¹Äºá¸¶á¸·á¸¸á¸¹á¸¼á¸½á¸ºá¸»Ä¿Å€È½Æšâ± â±¡â±¢É«É¬á¶…É­È´ÊŸï¼¬ï½Œ]",n:"[nÅƒÅ„Ç¸Ç¹Å‡ÅˆÃ‘Ã±á¹„á¹…Å…Å†á¹†á¹‡á¹Šá¹‹á¹ˆá¹‰NÌˆnÌˆÆÉ²È Æžáµ°á¶‡É³ÈµÉ´ï¼®ï½ŽÅŠÅ‹]",o:"[oÃ˜Ã¸Ã–Ã¶Ã“Ã³Ã’Ã²Ã”Ã´Ç‘Ç’ÅÅ‘ÅŽÅÈ®È¯á»Œá»ÆŸÉµÆ Æ¡á»Žá»ÅŒÅÃ•ÃµÇªÇ«ÈŒÈÕ•Ö…]",p:"[pá¹”á¹•á¹–á¹—â±£áµ½Æ¤Æ¥áµ±]",q:"[qê–ê—Ê ÉŠÉ‹ê˜ê™qÌƒ]",r:"[rÅ”Å•ÉŒÉÅ˜Å™Å–Å—á¹˜á¹™ÈÈ‘È’È“á¹šá¹›â±¤É½]",s:"[sÅšÅ›á¹ á¹¡á¹¢á¹£êž¨êž©ÅœÅÅ Å¡ÅžÅŸÈ˜È™SÌˆsÌˆ]",t:"[tÅ¤Å¥á¹ªá¹«Å¢Å£á¹¬á¹­Æ®ÊˆÈšÈ›á¹°á¹±á¹®á¹¯Æ¬Æ­]",u:"[uÅ¬Å­É„Ê‰á»¤á»¥ÃœÃ¼ÃšÃºÃ™Ã¹Ã›Ã»Ç“Ç”Å°Å±Å¬Å­Æ¯Æ°á»¦á»§ÅªÅ«Å¨Å©Å²Å³È”È•âˆª]",v:"[vá¹¼á¹½á¹¾á¹¿Æ²Ê‹êžêŸâ±±Ê‹]",w:"[wáº‚áºƒáº€áºÅ´Åµáº„áº…áº†áº‡áºˆáº‰]",x:"[xáºŒáºáºŠáº‹Ï‡]",y:"[yÃÃ½á»²á»³Å¶Å·Å¸Ã¿á»¸á»¹áºŽáºá»´á»µÉŽÉÆ³Æ´]",z:"[zÅ¹Åºáºáº‘Å½Å¾Å»Å¼áº’áº“áº”áº•ÆµÆ¶]"},e=function(){var t,r,e,n,i="",o={};for(e in p)if(p.hasOwnProperty(e))for(i+=n=p[e].substring(2,p[e].length-1),t=0,r=n.length;t<r;t++)o[n.charAt(t)]=e;var s=new RegExp("["+i+"]","g");return function(t){return t.replace(s,function(t){return o[t]}).toLowerCase()}}();return t}),function(t,r){"function"==typeof define&&define.amd?define(r):"object"==typeof exports?module.exports=r():t.MicroPlugin=r()}(this,function(){var t={mixin:function(n){n.plugins={},n.prototype.initializePlugins=function(t){var r,e,n,i=[];if(this.plugins={names:[],settings:{},requested:{},loaded:{}},o.isArray(t))for(r=0,e=t.length;r<e;r++)"string"==typeof t[r]?i.push(t[r]):(this.plugins.settings[t[r].name]=t[r].options,i.push(t[r].name));else if(t)for(n in t)t.hasOwnProperty(n)&&(this.plugins.settings[n]=t[n],i.push(n));for(;i.length;)this.require(i.shift())},n.prototype.loadPlugin=function(t){var r=this.plugins,e=n.plugins[t];if(!n.plugins.hasOwnProperty(t))throw new Error('Unable to find "'+t+'" plugin');r.requested[t]=!0,r.loaded[t]=e.fn.apply(this,[this.plugins.settings[t]||{}]),r.names.push(t)},n.prototype.require=function(t){var r=this.plugins;if(!this.plugins.loaded.hasOwnProperty(t)){if(r.requested[t])throw new Error('Plugin has circular dependency ("'+t+'")');this.loadPlugin(t)}return r.loaded[t]},n.define=function(t,r){n.plugins[t]={name:t,fn:r}}}},o={isArray:Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}};return t});